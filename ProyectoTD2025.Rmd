---
title: "ProyectoTD2025"
author:
- Andrea Fu Castelló Sala
- Sergio Del Carme Moreno
- María Martínez Marí
- Jorge Navarro Rodríguez
- Iván Pérez Alonso
- Edurne Serigó Troyano
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# Configurar nombres en español para gráficos
options(OutDec = ",", digits = 2)
```

```{r}
## Cargamos las librerias que vamos a usar
library(pdftools)
library(tidyverse)
library(dplyr)
library(stringr)
library(ggplot2)
library(knitr)
```

## Introducción

Mercadona y otros supermecados como Lidl, Dia y Comsum han implantado el ticket electrónico y los usuarios que lo deseen pueden recibirlo como documento pdf en su correo electrónico, en lugar de hacerlo en papel.

Como alumnos del GCD nos plantemos el siguiente objetivo:

Queremos desarrollar un programa que permita analizar los tickets para realizar un seguimiento de evolución de precios, compras más habituales, productos más consumidos, supermercado habitual, hora de compra, etc.

Dado que el formato no es el mismo nos vamos a centrar en tickets de Mercadona.

Con este proyecto se espera desarrollar una herramienta capaz de leer y analizar automáticamente tickets de compra de Mercadona, extraídos en formato PDF, para obtener información útil sobre los hábitos de consumo.

## Material y métodos

Para este proyecto se ha utilizado un conjunto de tickets de compra proporcionados en formato PDF. Todos los tickets pertenecen, como hemos comentado antes, a supermercados Mercadona.

El análisis de datos se realiza utilizando el lenguaje de programación R.

Como sabemos, la librería `pdftools` y la función `pdf_text` sirven para cargar el contenido del ticket en un vector de texto. Por lo tanto, los tickets serán leídos uno a uno utilizando la función `pdf_text()` de la librería `pdftools`, que permite convertir el contenido del PDF en texto plano. A partir de ese texto, se ha extraído:

-   Encabezado (previo a productos) FIJO
-   Parte final (después del Total).
-   Si hay aparcamiento o no (línea extra)
-   Productos: · Venta por unidades · Venta al peso, FRUTA y VERDURA · Venta al peso, PESCADO · Venta LISTO COMER (No hay en los tickets proporcionados)

## Importación de datos

A continuacón realizaremos la importación de datos para cargar los tickets en pdf de mercadona:

Primero cargamos todos los datos.

```{r}

ruta_tickets<- 'data/'
archivos_pdf <- list.files(path = ruta_tickets, pattern = "Mercadona", 
                           full.names = TRUE, recursive = TRUE)

# Leer todos los archivos y construir un data frame
df_lineas <- do.call(rbind, lapply(archivos_pdf, function(archivo) {
  paginas <- pdf_text(archivo)
  texto <- paste(paginas, collapse = "\n")       # Unir todas las páginas
  lineas <- unlist(strsplit(texto, "\n"))        # Separar en líneas
  
  # Crear un data.frame con nombre del archivo, número de línea y texto
  data.frame(
    archivo = basename(archivo),
    linea = seq_along(lineas),
    texto = lineas,
    stringsAsFactors = FALSE
  )
}))

kable(head(df_lineas,52),caption= "Tabla de tickets de mercadona") #Se muestra el df de los tickets del mercadona
```

## Preguntas planteadas por el profesor

1.  ¿Cuáles son los 5 productos, de los vendidos por unidades, con más ventas? ¿Cuántas unidades de cada uno se han vendido?

```{r}

# Filtrar líneas que comienzan con un número (cantidad)
df_productos <- df_lineas %>% filter(str_detect(texto, "^\\d+\\s" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (^: inicio de linea, \\d+: \\d(me coge los digitos) y + (me coge uno o mas digitos, depende de cuantos haya) y \\s: al final tenga espacios en blanco (+: uno o varios)
                    )) %>%
  
# Extraer partes específicas de cada línea (con str_match): cantidad, nombre del producto, y precio
  mutate(
    matches = str_match(texto, "^(\\d+)\\s+(.*?)\\s+(\\d+,\\d{2})\\s+(\\d+,\\d{2})?$" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (^: comienzo de linea, (\\d+): una o mas cifras(cantidad),  \\s+: uno o mas espacios en blanco, (.*?): me dice el nombre del producto, \\s+: uno o mas espacios en blanco, (\\d+,\\d{2}): me coje el precio por unidades, \\s+: uno o mas espacios, (\\d+,\\d{2})?: me coje el importe total y, por ultimo $:final de linea)
                        ),
# Crear columnas a partir de los grupos extraídos
    cantidad = as.numeric(matches[, 2]),
    producto = str_trim(matches[, 3])
  ) %>%
  filter(!is.na(cantidad), !is.na(producto))

# Agrupar y sumar las cantidades por producto (unidades vendidas por producto)
top_5_productos <- df_productos %>%
  group_by(producto) %>%
  summarise(unidades_vendidas = sum(cantidad), .groups = "drop") %>%

# Ordenar y obtener el top 5 de productos mas vendidos  
  arrange(desc(unidades_vendidas)) %>%
  slice_head(n = 5)

#Mostrar el resultado
print(top_5_productos)

# Como podemos observar, los cinco productos más vendidos por unidades son: leche desnatada con calcio (22 unidades), barra campesina(12 unidades), chapata cristal(12 unidades), garbanzo m.cocido (12 unidades) y leche desnatada sin lactosa (12 unidades)

```

2.  Si consideramos la categoría de FRUTAS Y VERDURAS. Cuáles son los 5 productos más vendidos? ¿Cuántos kilos se han vendido de cada uno de estos productos?

```{r}

# Lista de palabras clave de frutas y verduras
productos_frutas_verduras <- c("manzana", "plátano", "naranja", "fresa", "pera", "kiwi", "sandía", "melon", "tomate", "lechuga", "pepino", "pimiento", "berenjena", "calabacín", "ajo", "cebolla", "zanahoria", "patata", "aguacate", "brocoli", "col", "apio", "alcachofa", "espárrago", "frambuesa", "cereza", "mango", "limón", "mandarina")

# Buscar líneas del df_lineas que contengan alguna de estas palabras
frutas_lineas_idx <- grep(paste(productos_frutas_verduras, collapse = "|"), tolower(df_lineas$texto))

# Crear un nuevo data.frame para guardar resultados
resultados <- data.frame(producto = character(), cantidad_kg = numeric(), stringsAsFactors = FALSE)

# Recorremos cada línea que contiene una fruta o verdura
for (i in frutas_lineas_idx) {
  linea_producto <- df_lineas$texto[i]
 #Extraer nombre del producto
  producto <- gsub("\\s*\\d+\\s*(kg|KG).*" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (\\s*: puede ser que tenga o no espacios en blanco, \\d+: uno o mas digitos, \\s*: espacios opcionales entre el numero y el kilo, kg: que sean kilos y .*:quiere decir que puede ser que detras tenga otra cosa)
                   , "", linea_producto)  # Limpia el nombre del producto

  # Extraer la cantidad de la misma línea
  match_misma_linea <- regmatches(linea_producto, regexpr("\\d+[.,]?\\d*\\s*(kg|KG)" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (\\d+:uno o mas digitos, [.,]?: despues hay una coma o punto y coma, \\d*: seguido de cero o algunos digitos, \\s*: despues cero o algun espacio y kg: acabado en kg)
                                                          , linea_producto, ignore.case = TRUE))
  
  if (length(match_misma_linea) > 0) {
    cantidad <- as.numeric(gsub(",", ".", gsub(" kg", "", tolower(match_misma_linea))))
  } 
  # Si no hay kilos en esa línea, intenta mirar la línea siguiente
  else if (i + 1 <= nrow(df_lineas)) {
    # Revisar la línea siguiente
    linea_siguiente <- df_lineas$texto[i + 1]
    match_siguiente_linea <- regmatches(linea_siguiente, regexpr("\\d+[.,]?\\d*\\s*(kg|KG)" # Es exactamente lo mismo de antes 
                                                                 , linea_siguiente, ignore.case = TRUE))
    
    if (length(match_siguiente_linea) > 0) {
      cantidad <- as.numeric(gsub(",", ".", gsub(" kg", "", tolower(match_siguiente_linea))))
    } else {
      cantidad <- NA
    }
  } else {
    cantidad <- NA
  }
  
  # Añadir los datos a la tabla
  resultados <- rbind(resultados, data.frame(producto = producto, cantidad_kg = cantidad, stringsAsFactors = FALSE))
}

# Limpieza robusta del nombre del producto
resultados$producto <- toupper(resultados$producto)                     # Todo a mayúsculas
resultados$producto <- gsub("^[^A-Z]*" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (^: inicio de linea, [^A-Z]: seguido de cualquier caracter que no sea una letra mayuscula de la A a la Z, *: puede ser que haya o no alguna repeticion de este patron)
                            , "", resultados$producto)        # Elimina cualquier cosa que no sea letra al inicio
resultados$producto <- gsub("\\s+" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (\\s+: uno o mas espacios en blanco)
                            , " ", resultados$producto)           # Reemplaza múltiples espacios por uno solo
resultados$producto <- trimws(resultados$producto)                      # Quita espacios delante y detrás


# Agrupar y resumir por producto ya normalizado
resumen <- resultados %>%
  filter(!is.na(cantidad_kg)) %>%
  group_by(producto) %>%
  summarise(kilos_totales = sum(cantidad_kg)) %>%
  arrange(desc(kilos_totales))

# Ver los 5 más vendidos
head(resumen, 5)

# Los cinco productos mas vendidos de frutas y verduras son NARANJA	con 82.062Kg, PATATA con	74.800Kg, MANDARINA	con 31.186Kg, CEBOLLA con	22.000Kg y PEPINO	con 19.624Kg.
```

3.  Si consideramos la categoría de PESCADO. Cuáles son los 5 productos más vendidos? ¿Cuántos kilos se han vendido de cada uno de estos productos?

```{r}

# Lista de productos de la categoría pescado
productos_pescado <- c("merluza", "salmón", "bacalao", "atún", "lubina", "dorada", "boquerón", "anchoa", "gamba", "calamar", "sepia", "pulpo", "lenguado", "rape", "pez espada", "rodaballo", "jurel", "caballa", "sardina", "mejillón")

# Buscar líneas que contengan alguno de esos productos
pescado_lineas_idx <- grep(paste(productos_pescado, collapse = "|"), tolower(df_lineas$texto))

# Inicializar el data.frame vacío
resultados_pescado <- data.frame(producto = character(), cantidad_kg = numeric(), stringsAsFactors = FALSE)

# Bucle para recorrer cada línea con pescado
for (i in pescado_lineas_idx) {
  linea_producto <- df_lineas$texto[i]
  # Extraer solo el nombre del producto
  producto <- gsub("\\s*\\d+\\s*(kg|KG).*" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (\\s*: puede ser que tenga o no espacios en blanco, \\d+: uno o mas digitos, \\s*: espacios opcionales entre el numero y el kilo, kg: que sean kilos y .*:quiere decir que puede ser que detras tenga otra cosa)
                   , "", linea_producto)
  
  # Buscar la cantidad de kilos en la misma línea
  match_misma_linea <- regmatches(linea_producto, regexpr("\\d+[.,]?\\d*\\s*(kg|KG)", linea_producto, ignore.case = TRUE))
  
  if (length(match_misma_linea) > 0) {
    # Busca un número decimal seguido de la palabra "kg" y lo convierte en número decimal con gsub()
    cantidad <- as.numeric(gsub(",", ".", gsub(" kg", "", tolower(match_misma_linea))))
  } 
  # Si no encuentra el peso en la línea actual, mira en la siguiente
  else if (i + 1 <= nrow(df_lineas)) {
    # Revisar la línea siguiente
    linea_siguiente <- df_lineas$texto[i + 1]
    match_siguiente_linea <- regmatches(linea_siguiente, regexpr("\\d+[.,]?\\d*\\s*(kg|KG)" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (\\d+:uno o mas digitos, [.,]?: despues hay una coma o punto y coma, \\d*: seguido de cero o algunos digitos, \\s*: despues cero o algun espacio y kg: acabado en kg)
                                                                 , linea_siguiente, ignore.case = TRUE))
    
    if (length(match_siguiente_linea) > 0) {
      cantidad <- as.numeric(gsub(",", ".", gsub(" kg", "", tolower(match_siguiente_linea))))
    } else {
      cantidad <- NA
    }
  } else {
    cantidad <- NA
  }
  
  # Guardar en el data.frame
  resultados_pescado <- rbind(resultados_pescado, data.frame(producto = producto, cantidad_kg = cantidad, stringsAsFactors = FALSE))
}

# Normalización del texto del producto
resultados_pescado$producto <- toupper(resultados_pescado$producto)
resultados_pescado$producto <- gsub("^[^A-Z]*" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (^: inicio de linea, [^A-Z]: seguido de cualquier caracter que no sea una letra mayuscula de la A a la Z, *: puede ser que haya o no alguna repeticion de este patron)
                                    , "", resultados_pescado$producto)
resultados_pescado$producto <- gsub("\\s+" # Esto quiere decir que del texto del ticket sacamos todo aquello que empiece por (\\s+: uno o mas espacios en blanco)
                                    , " ", resultados_pescado$producto)
resultados_pescado$producto <- trimws(resultados_pescado$producto)

# Agrupar y sumar los kilos
resumen_pescado <- resultados_pescado %>%
  filter(!is.na(cantidad_kg)) %>%
  group_by(producto) %>%
  summarise(kilos_totales = sum(cantidad_kg)) %>%
  arrange(desc(kilos_totales))

# Mostrar los 5 productos de pescado más vendidos
head(resumen_pescado, 5)

# Los cinco productos de pescado más vendidos son rodaballo con	3.672Kg, sepia lonja con 3.584Kg, dorada con	2.934Kg, sepia fresca con	2.642Kg y sepia sucia refrig con	2.402Kg.
```

4.  Muestra mediante un gráco de líneas como ha variado el precio por kilo de las bananas y los plátanos en los tickets disponibles, a lo largo del tiempo.

```{r figura-bananas_platanos,  fig.cap="Evolución de precio por kilo de las bananas y los plátanos"}

#Filtrar las lineas que contengan platano y banana
frutas <- df_lineas %>% filter(str_detect(tolower(texto), "platano|banana"))

#Creamos un vector con los nombres de los tickets que han combrado banana o platano
archivo_frutas <- frutas %>% select(archivo) #filtramos los nombres
archivo_frutas <- as.vector(archivo_frutas$archivo) #Convertir a vector

#Creamos un df que contiene las fechas de los tickets que han comprado platano o banana
df_fechas <- df_lineas %>% filter(linea == "5") %>% right_join(data.frame(archivo = archivo_frutas), by = "archivo") #filtramos las fechas
df_fechas <- df_fechas %>%  mutate(fecha = str_extract(texto, "\\b\\d{2}/\\d{2}/\\d{4}\\b")) %>% select(-texto) #Guardamos solo la fecha
frutas$fecha <- df_fechas$fecha #Guardamos en el vector de frutas
frutas$fecha <- as.Date(frutas$fecha, format = "%d/%m/%Y") #Convertimos en fecha

#Obtener el precio por kilo de platano y banana
filas_frutas <- which(str_detect(tolower(df_lineas$texto), "platano|banana")) #Buscamos la linea de platano o banana
filas_precio_kilo <- filas_frutas + 1 #Obtenemos la linea del precio por kilo
frutas$precio <- df_lineas %>% slice(filas_precio_kilo)%>%pull(texto) #Se agrega al df de frutas
frutas <- frutas %>%  mutate(precio_kg = str_extract(precio, "\\b\\d+,\\d{2}\\s€/kg\\b")) %>% select(-precio) #Se guarda solo el precio por kilo
frutas <- frutas %>%
  mutate(precio_kg = str_replace(precio_kg, " €/kg", "") %>%  # Elimina " €/kg"
         str_replace(",", ".") %>%     # Cambia coma por punto decimal
         as.numeric())

#Arreglar el df
frutas <- frutas %>% select(-archivo) %>% select(-linea) #Eliminar columnas sobrantes
frutas <- frutas %>%  mutate(tipo = str_extract(texto, "BANANA|PLATANO"))%>% select(-texto)

# Gráfico de líneas
ggplot(frutas, aes(x = fecha, y = precio_kg, color = tipo)) +
  geom_line() +
  geom_point() +
  labs(title = "Evolución de Precios por Kg",
       x = "Fecha",
       y = "Precio por Kg",
       color = "Tipo de Fruta")
```

5.  ¿Cuál es la procedencia de los tickets? ¿Qué ciudad/ pueblo tiene un mayor número de tickets?

```{r tabla-procedencia}
#Creamos un nuevo vector con los lugares de procedencia de los tickets
procedencia <- df_lineas %>% filter(linea == "3") %>% pull(texto) #Filtrar por el lugar
procedencia <- gsub("^\\s+|\\s+$|[0-9]", "", procedencia) #Guardar solo la ciudad/pueblo

procedencia <- as.data.frame(table(procedencia)) #Crear un df a partir de la frecuencia de cada ciudad/pueblo
procedencia <- procedencia[order(-procedencia$Freq), ] #Ordenamos de mayor a menor la frecuencia

knitr::kable(procedencia, 
             caption = "Procedencia de los tickets", 
             booktabs = TRUE)

```

Como se observa en la Tabla \@ref(tab:tabla-procedencia), las diferentes ciudades o pueblos de procedencia de los tickets, siendo Valencia la que presenta el mayor número.

6.  Muestra mediante un diagrama el número de tickets recogidos cada día de las semana. ¿Si tuvieses que cerrar un día entre semana qué día lo harías?

```{r figura-semanas, fig.cap="Tickets recogidos cada día de las semana"}
df_fechas <- df_lineas %>% filter(linea == "5") #filtrar fechas
df_fechas <- df_fechas %>%  mutate(fecha = str_extract(texto, "\\b\\d{2}/\\d{2}/\\d{4}\\b")) %>% select(-texto) #Guardamos solo la fecha
df_fechas$fecha <- as.Date(df_fechas$fecha, format = "%d/%m/%Y") #Convertir str a fecha

df_fechas$dia_semana <- weekdays(df_fechas$fecha) #Crear una nueva columna con los dias de la semana de cada fecha
dia_semana <- as.vector(df_fechas$dia_semana) #Convertir a vector solo de los dias de la semana

dia_semana <- as.data.frame(table(dia_semana)) #Convertir a df a partir de la frecuencia de cada dia de la semana
names(dia_semana)[names(dia_semana) == "dia_semana"] <- "semana"

orden_dias <- c("lunes", "martes", "miércoles", "jueves", "viernes", "sábado", "domingo")
dia_semana$semana <- factor(dia_semana$semana, levels = orden_dias)

#Diagrama
ggplot(dia_semana, aes(x = semana, y = Freq, fill = semana)) +
  geom_bar(stat = "identity") +  # "identity" usa los valores de 'Freq'
  labs(title = "Tickets recogidos cada día de las semana",
    x = "Día de la semana",
    y = "Número de tickets")
```

Como se observa en la Tabla \@ref(fig:figura-semanas), Si tuvieses que cerrar un día entre semana seria el jueves

## Preguntas planteadas por nosotros

7.  ¿Cuál es la media de ventas para cada día de la semana?

    ```{r}
    # 1. Obtener líneas con fechas
    df_fechas <- df_lineas %>%
      filter(str_detect(texto, "\\b\\d{2}/\\d{2}/\\d{4}\\b")) %>%
      mutate(
        fecha = as.Date(str_extract(texto, "\\b\\d{2}/\\d{2}/\\d{4}\\b"), format = "%d/%m/%Y")
      ) %>%
      select(archivo, fecha)

    # 2. Identificar líneas que contienen la cabecera de productos
    df_cabeceras <- df_lineas %>%
      filter(str_detect(texto, regex("Descripción.*P\\. Unit.*Importe", ignore_case = TRUE))) %>%
      select(archivo, linea) %>%
      rename(linea_inicio = linea)

    # 3. Unir cabeceras con la siguiente línea de cada archivo para marcar el inicio de productos
    df_cabeceras <- df_cabeceras %>%
      mutate(linea_inicio = as.integer(linea_inicio))

    # 4. Añadir columna para marcar si una línea es un producto (posterior a la cabecera pero antes del TOTAL o siguiente ticket)
    df_lineas_productos <- df_lineas %>%
      left_join(df_cabeceras, by = "archivo") %>%
      group_by(archivo) %>%
      mutate(es_producto = linea > linea_inicio & !str_detect(texto, regex("TOTAL|IVA|TARJETA|FACTURA|ENTRADA|SALIDA|€", ignore_case = TRUE))) %>%
      ungroup()

    # 5. Filtrar solo las líneas de productos
    df_productos <- df_lineas_productos %>%
      filter(es_producto)

    # 6. Contar número de productos por archivo
    conteo_productos <- df_productos %>%
      group_by(archivo) %>%
      summarise(num_productos = n())

    # 7. Unir con fechas
    df_final <- left_join(conteo_productos, df_fechas, by = "archivo") %>%
      mutate(dia_semana = str_to_lower(weekdays(fecha)))

    # 8. Calcular media de productos comprados por día de la semana
    media_productos_dia <- df_final %>%
      group_by(dia_semana) %>%
      summarise(media_productos = mean(num_productos)) %>%
      arrange(factor(dia_semana, levels = c("lunes", "martes", "miércoles", "jueves", "viernes", "sábado", "domingo")))

    print(media_productos_dia)


    ```

8.  ¿Cómo ha evolucionado el precio por unidad o por kilo de un producto específico a lo largo del tiempo? Hacer el gráfico de cómo varía el precio de un producto a lo largo del tiempo.

9.  ¿Cuáles son los productos menos vendidos en el conjunto de tickets disponibles?

10. En una compra, ¿cuál es el producto por unidad que se adquiere en mayor cantidad? (NO FRUTAS Y VERDURAS NI PESCADO)

11. ¿Cuáles son las combinaciones de productos más frecuentes (dos productos que se compren juntos)?

12. ¿Hay estacionalidad en ciertos productos (produtos que se compran más en cierta fecha del año)?

13. ¿Cuántos productos se compran por ticket, en promedio?

14. ¿Cuál es el importe medio por ticket? ¿Cuál es el ticket más caro registrado? ¿Y el más barato?

15. ¿Cuál es la cantidad total de dinero que se obtiene en impuestos cuando se venden alimentos con un 10% de IVA? ¿Y con un 21% y un 5%?
```{r}
library(knitr)

#Extraemos las líneas de IVA del ticket
lineas_IVA<-df_lineas %>% 
  
  #Filtramos las líneas que coincidan con el patrón de IVA (porcentaje, base y la cuota)
  filter(str_detect(texto, "^\\s*\\d{1,2}%?\\s+\\d+[,.]\\d{2}\\s+\\d+[,.]\\d{2}")) %>% 
  mutate(
  texto=str_squish(texto),
  
  #Extraemos tipo de IVA, base imponible y cuota
  porcentaje = str_extract(texto, "^\\d{1,2}"),
  base = str_extract(texto, "(?<=\\s)\\d+[,.]\\d{2}(?=\\s+\\d+[,.]\\d{2}$)"),
  cuota = str_extract(texto, "\\d+[,.]\\d{2}$")
  ) %>% 
  
  #Convertimos los strings en valores numéricos
  mutate(
    porcentaje = as.numeric(str_replace(porcentaje, "%", "")),
    base = as.numeric(str_replace(base, ",", ".")),
    cuota = as.numeric(str_replace(cuota, ",", "."))
  ) %>%
  #Seleccionamos las columnas que nos interesan
  select(archivo, linea, porcentaje, base, cuota)

#Sumamos la cuota por tipo de IVA
total_TipoIVA <- lineas_IVA %>%
  group_by(porcentaje) %>%
  summarise(
    Cuota= sum(cuota, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(desc(porcentaje))

#Mostrar solo los tipos que nos interesan, en este caso solo el 21%, 10% y 5%
IVA_filtrado <- total_TipoIVA %>%
  filter(porcentaje %in% c(21, 10, 5))

#Mostramos el resultado mediante una tabla.
kable(IVA_filtrado, caption = "Total de IVA por tipo de porcentaje")

```

16. ¿A qué horas se suele ir más a comprar en los supermercados? ¿Cuáles son las que menos?

17. ¿Qué método de pago es más frecuente en los tickets: tarjeta o efectivo? Muéstralo mediante un box plot ¿Cuánto se ha gastado en total con cada método de pago?

# Conclusión

Hemos presentado:

1.  Tablas:
    -   Tabla \@ref(tab:tabla-procedencia): Datos de procedencia de los tickets
2.  Figuras:
    -   Figura \@ref(fig:figura-bananas_platanos): Evolución de precio por kilo de las bananas y los plátanos
    -   Figura \@ref(fig:figura-semanas): Tickets recogidos cada día de las semana
