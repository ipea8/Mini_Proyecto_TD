---
title: "ProyectoTD2025"
author: "Grupos E"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introducción

Mercadona y otros supermecados como Lidl, Dia y Comsum han implantado el ticket electrónico y los usuarios que lo deseen pueden recibirlo como documento pdf en su correo electrónico, en lugar de hacerlo en papel.

Como alumnos del GCD nos plantemos el siguiente objetivo:

Queremos desarrollar un programa que permita analizar los tickets para realizar un seguimiento de (evolución de precios, compras más habituales, productos más consumidos, supermercado habitual, hora de compra, etc).

Dado que el formato no es el mismo nos vamos a centrar en tickets de Mercadona.

Con este proyecto se espera desarrollar una herramienta capaz de leer y analizar automáticamente tickets de compra de Mercadona, extraídos en formato PDF, para obtener información útil sobre los hábitos de consumo.

A continuacón realizaremos la importación de datos para cargar los tickets en pdf de mercadona:

Primero cargamos todos los datos.
```{r}
library(pdftools)
library(tidyverse)

archivos_pdf <- list.files(path = ".", pattern = "Mercadona", 
                           full.names = TRUE, recursive = TRUE)

# Leer todos los archivos y construir un data frame
df_lineas <- do.call(rbind, lapply(archivos_pdf, function(archivo) {
  paginas <- pdf_text(archivo)
  texto <- paste(paginas, collapse = "\n")       # Unir todas las páginas
  lineas <- unlist(strsplit(texto, "\n"))        # Separar en líneas
  
  # Crear un data.frame con nombre del archivo, número de línea y texto
  data.frame(
    archivo = basename(archivo),
    linea = seq_along(lineas),
    texto = lineas,
    stringsAsFactors = FALSE
  )
}))
```
A continuación con el df_lineas, creamos otro df quitando las lineas de texto que no nos sirven como texto en blanco o texto que se repite en todos los tickets.

```{r}
df <- df_lineas%>%filter(linea != "1" & linea != "4" & linea != "11" & texto != "" & texto != "     SE ADMITEN DEVOLUCIONES CON TICKET" & texto != "              DISPONE DE 20 MINUTOS" & texto != "            PARA RETIRAR SU VEHÍCULO")
```

